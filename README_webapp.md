# 🌐 42Tokyo レビュワー検索 Web アプリ

このWebアプリは、**42Tokyo校舎に現在ログイン中の学生の中から、選択した課題が一度でも終わっている人（status: finished）を探す**ためのツールです。

---

## 🎯 機能

- 📋 プルダウンメニューから課題を選択
- 🔍 現在校舎にいる学生をリアルタイムで検索
- ✅ 選択した課題が終わっている人（status: finished、点数不問）をリスト表示
- 📊 獲得点数順にソートして表示
- ⚡️ 超高速キャッシュシステムで瞬時に結果を表示
- 🎨 モダンで使いやすいUI

---

## 📦 準備

### 1. 依存パッケージのインストール

```bash
npm install
```

これで以下のパッケージがインストールされます：
- `express`: Webサーバー
- `axios`: HTTP通信
- `dotenv`: 環境変数管理

### 2. `.env` ファイルを設定

`intra.42.fr` の **API settings** ページで取得した `UID` と `SECRET` を使って
`.env` ファイルに以下を設定してください：

```bash
U_ID="u-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
SECRET="s-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
```

**注意**: `PROJECT_NAME` は不要です（Webアプリで選択できます）

---

## 🚀 実行方法

### サーバーを起動

```bash
npm start
```

サーバーが起動すると以下のように表示されます：

```
🚀 サーバーが起動しました: http://localhost:3000
📍 42Tokyo レビュワー検索システム
```

### ブラウザでアクセス

ブラウザで以下のURLを開いてください：

```
http://localhost:3000
```

### 使い方

1. プルダウンメニューから課題を選択
2. 「🔍 検索」ボタンをクリック
3. 数分待つと、現在校舎にいる該当者のリストが表示されます

---

## 📝 仕組み

1. **起動時キャッシュ作成**
   - 現在校舎にいるユーザーを取得（`location != null`）
   - 各ユーザーの全プロジェクト情報を取得してメモリにキャッシュ

2. **課題リスト取得** (`GET /api/projects`)
   - 42Tokyoでよく使われる課題のリストを返す

3. **レビュワー検索** (`GET /api/reviewers/:projectName`)
   - キャッシュから直接検索（APIリクエスト不要）
   - 以下の条件を満たす人を抽出：
     - `project.name` が一致
     - `status == "finished"` （課題が一度でも終わっている）
     - **点数は不問**（0点でもfinishedなら表示）
   - 結果を点数順（降順）にソートして返す
   - **検索時間: 0-1ms** ⚡️

---

## ⚙️ 設定

### ポート番号の変更

デフォルトは3000番ポートですが、`.env`ファイルで変更できます：

```bash
PORT=8080
```

### 検索するページ数の変更

デフォルトでは最初の10ページ（最大1000人）を検索します。
`server.js`の以下の行を変更することで調整できます：

```javascript
for (let page = 1; page <= 10; page++) {  // ←この数字を変更
```

---

## ⚠️ 注意事項

- **初回起動時**: キャッシュ作成に1-2分程度かかります（その後は瞬時に検索可能）
- **検索条件**: `status == "finished"` のみ（点数は不問）
  - 一度でも課題を終わらせた（finished）人を表示
  - やり直している場合でも、finishedステータスがあれば表示
  - 点数は0点でも表示されます（レビューの参考にしてください）
- **キャッシュ更新**: 5分ごとに自動更新（手動更新も可能）
- **APIレート制限**: キャッシュ作成時のみAPIを使用（検索時は不要）
- **検索範囲**: デフォルトでは最初の1000人程度を検索対象としています

---

## 📂 ファイル構成

```
findreviewer/
├── server.js           # バックエンドサーバー
├── package.json        # 依存関係定義
├── .env               # API認証情報（要作成）
├── public/            # フロントエンド
│   ├── index.html    # メインページ
│   └── style.css     # スタイルシート
├── API.sh            # 元のシェルスクリプト
└── readme.md         # 元のREADME
```

---

## 🔧 トラブルシューティング

### 「トークン取得エラー」が出る

- `.env`ファイルの`U_ID`と`SECRET`が正しいか確認してください
- intra.42.frのAPIアプリ設定が有効か確認してください

### 「検索結果が表示されない」

- 現在校舎内にログインしている人がいない可能性があります
- 時間帯を変えて試してみてください

### 「処理が遅い」

- APIのレート制限対策のため、意図的に遅延を入れています
- `server.js`内の`setTimeout`の値を調整できますが、Too Many Requestsエラーが発生する可能性があります

---

## 🧩 依存ツール

- **Node.js** (v14以上推奨)
- **npm**

macOSの場合は以下でインストール可能：

```bash
brew install node
```

---

## 📄 ライセンス

MIT License

---

## 🎨 元のシェルスクリプトとの違い

| 機能 | シェルスクリプト | Webアプリ |
|------|---------------|----------|
| 実行環境 | ターミナル | ブラウザ |
| 課題選択 | .envで固定 | プルダウンで動的選択 |
| 結果表示 | テキストファイル | リアルタイムWeb表示 |
| UI | なし | モダンなGUI |
| 複数検索 | 毎回スクリプト実行 | 画面上で即座に変更可能 |

---

## 💡 今後の拡張案

- [ ] 検索履歴の保存
- [ ] お気に入り課題のブックマーク機能
- [ ] 特定のユーザーを除外する機能
- [ ] キャンパス選択機能（現在は26=Tokyo固定）
- [ ] WebSocketでリアルタイム更新

---

## 🌐 一般公開（デプロイ）

このアプリを一般公開したい場合は、[DEPLOY.md](DEPLOY.md)を参照してください。

Render.com、Railway、Vercelなどでの無料デプロイ方法を詳しく解説しています。

**注意**: GitHub Pagesは使えません（Node.jsサーバーが必要なため）

---

**Enjoy coding! 🚀**

